<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bol√£o da Sorte üí∞</title>
<style>
:root{
  --bg:#0f172a;--card:#1e293b;--ink:#f8fafc;--accent:#f59e0b;--muted:#94a3b8;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--ink)}
header{text-align:center;position:relative;overflow:hidden}
.banner{width:100%;height:260px;object-fit:cover;position:absolute;inset:0;opacity:0;transition:opacity 1.2s ease-in-out}
.banner.active{opacity:1}
h1{margin-top:280px;color:var(--accent)}
main{max-width:600px;margin:18px auto;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 4px 30px rgba(0,0,0,.4)}
.photo-grid{display:flex;justify-content:space-around;flex-wrap:wrap;margin-bottom:20px}
.photo{width:80px;height:80px;border-radius:50%;overflow:hidden;border:3px solid transparent;cursor:pointer;transition:.3s}
.photo img{width:100%;height:100%;object-fit:cover}
.photo.selected{border-color:var(--accent);transform:scale(1.1)}
label{font-size:.9em;color:var(--muted)}
input{width:100%;padding:10px;border:none;border-radius:8px;background:#0f172a;color:var(--ink);font-size:1em}
button{background:var(--accent);color:#000;font-weight:700;border:none;border-radius:8px;padding:12px;cursor:pointer}
button[disabled]{opacity:.6;cursor:not-allowed}
button:hover{opacity:.9}
.msg{text-align:center;margin-top:14px;color:var(--muted);font-size:.9em}
#premioCard{text-align:center;background:#0b1120;padding:14px;border-radius:10px;margin-bottom:18px}
#premioValor{font-size:1.6em;font-weight:700;color:var(--accent)}
#qrcodeTela{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);color:#fff;align-items:center;justify-content:center;z-index:99}
#qrcodeConteudo{background:#111;padding:20px;border-radius:12px;text-align:center;width:90%;max-width:380px}
#qrcodeConteudo img{max-width:200px;border-radius:8px;margin:10px auto}
.copyBtn{background:var(--accent);color:#000;padding:8px 12px;border:none;border-radius:8px;cursor:pointer}
.closeBtn{background:#ef4444;color:#fff;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;margin-top:8px}
.totalPix{margin-top:8px;font-size:14px;opacity:.9}
@media(max-width:600px){
  h1{margin-top:220px;font-size:1.6em}
  #qrcodeConteudo{max-width:320px}
}
</style>
</head>
<body>

<header>
  <!-- Banner rotativo -->
  <img class="banner active" src="https://images.unsplash.com/photo-1606813902859-4cb0c0bfae24?q=80&w=1200&auto=format&fit=crop" alt="banner1">
  <img class="banner" src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop" alt="banner2">
  <img class="banner" src="https://images.unsplash.com/photo-1542831371-d531d36971e6?q=80&w=1200&auto=format&fit=crop" alt="banner3">
  <h1>Bol√£o da Sorte üéâ</h1>
  <p>Participe e concorra ao pr√™mio acumulado!</p>
</header>

<main>
  <div id="premioCard">
    <div>Total do pr√™mio l√≠quido (-25%):</div>
    <div id="premioValor">R$ 0,00</div>
    <small>Se houver mais de um ganhador, o pr√™mio ser√° dividido igualmente.</small>
  </div>

  <div class="photo-grid" id="photoGrid">
    <div class="photo"><img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?w=400" alt="1"></div>
    <div class="photo"><img src="https://images.unsplash.com/photo-1581091215367-59ab6d3213b1?w=400" alt="2"></div>
    <div class="photo"><img src="https://images.unsplash.com/photo-1564869733280-233b6fbc55d0?w=400" alt="3"></div>
    <div class="photo"><img src="https://images.unsplash.com/photo-1550510537-0b38c0d62f5a?w=400" alt="4"></div>
    <div class="photo"><img src="https://images.unsplash.com/photo-1593642532973-d31b6557fa68?w=400" alt="5"></div>
  </div>

  <form id="formBolao">
    <label>Nome completo</label>
    <input type="text" id="nome" required placeholder="Seu nome completo">

    <label>E-mail</label>
    <input type="email" id="email" required placeholder="seu@email.com">

    <label>Telefone / WhatsApp</label>
    <input type="tel" id="telefone" required placeholder="(00) 00000-0000" maxlength="16">

    <input type="hidden" id="fotoSelecionada" value="">
    <input type="hidden" id="qtd" value="">
    <button id="btnEnviar" type="submit">Confirmar participa√ß√£o</button>
  </form>

  <div class="msg" id="msg"></div>
</main>

<!-- Tela de pagamento -->
<div id="qrcodeTela">
  <div id="qrcodeConteudo">
    <h2>Pagamento via PIX</h2>
    <img src="https://i.ibb.co/gyyxQkR/qrcode-exemplo.png" alt="QR Code PIX">
    <p>Chave aleat√≥ria:</p>
    <p id="pixKey" style="font-weight:bold;">00000000-0000-0000-0000-000000000000</p>
    <div class="totalPix">Total a pagar: <b id="pixTotal">R$ 0,00</b></div>
    <button class="copyBtn" id="btnCopiar">Copiar chave</button>
    <p style="margin-top:10px;font-size:.9em">Ap√≥s o pagamento envie o comprovante para o WhatsApp<br><b>(77) 99825-3249</b></p>
    <button class="closeBtn" onclick="fecharQr()">Fechar</button>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyW26xe2neO6L5I-yhyhDEaHNVIShwSEKkvMPjEdtn83412GWK8-UcW9CW3CZFcyLdx/exec";
const valorCota = 5;
const msg = document.getElementById('msg');
const premioValor = document.getElementById('premioValor');
const telefone = document.getElementById('telefone');
const qrcodeTela = document.getElementById('qrcodeTela');
const pixKey = document.getElementById('pixKey');
const pixTotal = document.getElementById('pixTotal');
const btnCopiar = document.getElementById('btnCopiar');
const btnEnviar = document.getElementById('btnEnviar');

// Banner rotativo
let banners = document.querySelectorAll('.banner');
let atual = 0;
setInterval(()=>{
  banners[atual].classList.remove('active');
  atual = (atual + 1) % banners.length;
  banners[atual].classList.add('active');
}, 4000);

// Telefone m√°scara
telefone.addEventListener('input', e=>{
  let v = e.target.value.replace(/\D/g,'').slice(0,11);
  if(v.length > 10){
    v = v.replace(/^(\d{2})(\d{5})(\d{4}).*/,'($1) $2-$3');
  }else{
    v = v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/,'($1) $2-$3');
  }
  e.target.value = v.trim();
});

// PIX
function fecharQr(){qrcodeTela.style.display='none';}
btnCopiar.onclick = ()=>{
  navigator.clipboard.writeText(pixKey.textContent);
  btnCopiar.textContent = "Chave copiada!";
  setTimeout(()=>btnCopiar.textContent="Copiar chave",1500);
};

// Sele√ß√£o de fotos + quantidade
document.querySelectorAll('.photo').forEach(f=>{
  f.addEventListener('click',()=>{
    document.querySelectorAll('.photo').forEach(x=>x.classList.remove('selected'));
    f.classList.add('selected');
    const src = f.querySelector('img').src;
    document.getElementById('fotoSelecionada').value = src;
    let qtd;
    do{
      const ans = prompt('Quantas cotas deseja comprar? (R$5 cada)');
      if(ans === null) break;
      qtd = parseInt(ans, 10);
    }while(isNaN(qtd) || qtd < 1);
    if(qtd) document.getElementById('qtd').value = qtd;
  });
});

// Atualiza pr√™mio l√≠quido (-25%)
async function atualizarPremio(){
  try{
    const r = await fetch(SCRIPT_URL + "?action=premio", {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP ' + r.status);
    const j = await r.json();
    premioValor.textContent = j.valor || "R$ 0,00";
  }catch(err){
    console.warn('Erro ao buscar pr√™mio:', err);
  }
}
setInterval(atualizarPremio, 5000);
atualizarPremio();

// Envio (POST simples sem preflight)
document.getElementById('formBolao').addEventListener('submit', async e=>{
  e.preventDefault();
  msg.textContent = "";
  btnEnviar.disabled = true;

  // valida√ß√µes m√≠nimas
  if(!document.getElementById('fotoSelecionada').value){
    msg.textContent = "Selecione uma das 5 op√ß√µes acima.";
    btnEnviar.disabled = false; return;
  }
  if(!document.getElementById('qtd').value){
    msg.textContent = "Informe a quantidade de cotas.";
    btnEnviar.disabled = false; return;
  }

  const data = {
    action:"registrar",
    nome:document.getElementById('nome').value.trim(),
    email:document.getElementById('email').value.trim(),
    telefone:telefone.value.trim(),
    qtd:document.getElementById('qtd').value,
    foto:document.getElementById('fotoSelecionada').value,
    valor:valorCota,
    status:"PENDENTE"
  };

  try{
    const res = await fetch(SCRIPT_URL, {
      method:"POST",
      // Envia JSON mas com Content-Type 'text/plain' para evitar preflight CORS no GAS
      headers:{ "Content-Type":"text/plain;charset=utf-8" },
      body: JSON.stringify(data),
      redirect: "follow",
      cache: "no-store"
    });

    const txt = await res.text().catch(()=> "");
    if(txt.includes("duplicado")){
      msg.textContent = "‚ö†Ô∏è Esse n√∫mero de telefone j√° possui uma aposta!";
      btnEnviar.disabled = false;
      return;
    }

    if(res.ok || txt === "OK"){
      msg.textContent = "‚úÖ Aposta registrada com sucesso! Aguarde aprova√ß√£o.";
      const total = Number(data.qtd) * valorCota;
      pixTotal.textContent = total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      qrcodeTela.style.display='flex';
      // limpa campos (mant√©m telefone)
      document.getElementById('nome').value = "";
      document.getElementById('email').value = "";
      document.getElementById('qtd').value = "";
      document.getElementById('fotoSelecionada').value = "";
      document.querySelectorAll('.photo').forEach(x=>x.classList.remove('selected'));
    }else{
      msg.textContent = "N√£o consegui salvar. Verifique se o Apps Script est√° publicado como Web App (acesso: qualquer pessoa).";
    }
  }catch(err){
    console.error(err);
    msg.textContent = "Falha de conex√£o. Confira o link do Apps Script e a publica√ß√£o.";
  }finally{
    btnEnviar.disabled = false;
  }
});
</script>

</body>
</html>
