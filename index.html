<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bol√£o da Sorte üí∞</title>
<style>
:root{
  --bg:#0a0f1b; --card:#141c2f; --ink:#f8fafc; --muted:#9ca3af;
  --accent:#f59e0b; --accent2:#d97706; --ok:#22c55e; --err:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI}
.wrap{max-width:480px;margin:28px auto;padding:0 16px}
h1{color:var(--accent);text-align:center;margin:0 0 8px;font-size:28px}
.sub{color:var(--muted);text-align:center;margin:0 0 18px}
.card{background:var(--card);border-radius:16px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
.premio{background:#0f172a;border:1px solid #1e293b;border-radius:12px;text-align:center;padding:14px;margin-bottom:18px}
.premio small{color:var(--muted)}
.valor{color:var(--accent);font-size:28px;font-weight:800;margin-top:6px}

/* ====== FOTOS ====== */
.grid{
  display:flex;
  gap:10px;
  justify-content:space-between;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.photo-item{
  text-align:center;
  width:calc(25% - 8px);
}
.photo{
  width:72px;
  height:72px;
  border-radius:50%;
  overflow:hidden;
  border:3px solid transparent;
  cursor:pointer;
  transition:.25s;
  margin:0 auto 6px;
}
.photo img{width:100%;height:100%;object-fit:cover}
.photo.sel{border-color:var(--accent);transform:scale(1.06)}
.photo-name{
  font-size:13px;
  color:var(--muted);
  text-align:center;
  word-wrap:break-word;
}

/* ===== FORM ===== */
label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
input{width:100%;background:#0b1220;color:var(--ink);border:none;border-radius:10px;padding:12px;font-size:15px}
button{width:100%;border:none;border-radius:10px;padding:14px;font-weight:800;font-size:15px;cursor:pointer;transition:.2s}
.btn{background:var(--accent);color:#111;margin-top:14px}
.btn:hover{background:var(--accent2)}
.msg{margin-top:12px;text-align:center;font-size:14px;color:var(--muted)}
.msg.ok{color:var(--ok)}
.msg.err{color:var(--err)}
.whats{display:none;background:var(--ok);color:#fff;margin-top:10px}
.pix-box{display:none;background:#0f172a;border:1px solid #1e293b;border-radius:10px;padding:10px;margin-top:15px;text-align:center}
.pix-label{color:var(--muted);font-size:14px;margin-bottom:6px}
.pix-key{background:#1e293b;color:var(--ink);padding:8px 10px;border-radius:6px;font-size:14px;word-break:break-all;cursor:pointer;user-select:all}
.copied{color:var(--ok);font-size:13px;margin-top:6px}
.total-valor{margin-top:10px;font-size:16px;color:var(--accent);font-weight:700}

/* ===== Overlay ===== */
.overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  z-index:9999;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:var(--ink);
  text-align:center;
}
.loader{
  border:4px solid #1e293b;
  border-top:4px solid var(--accent);
  border-radius:50%;
  width:60px;
  height:60px;
  animation:spin 1s linear infinite;
  margin-bottom:16px;
}
@keyframes spin{100%{transform:rotate(360deg)}}
.overlay p{font-size:1.1em;color:var(--muted)}
</style>
</head>
<body>
<div class="overlay" id="overlay">
  <div class="loader"></div>
  <p>Enviando aposta...</p>
</div>

<div class="wrap">
  <h1>Bol√£o da Sorte üéâ</h1>
  <p class="sub">Participe e concorra ao pr√™mio acumulado!</p>

  <div class="card">
    <div class="premio">
      <small>Total do pr√™mio aprovado:</small>
      <div id="premio" class="valor">R$ 0,00</div>
    </div>

    <div class="grid" id="grid">
      <div class="photo-item">
        <div class="photo"><img src="https://github.com/ClenaStore/barreirense/blob/main/paste/Celine.jpg?raw=true" alt=""></div>
        <div class="photo-name">Celina</div>
      </div>
      <div class="photo-item">
        <div class="photo"><img src="https://github.com/ClenaStore/barreirense/blob/main/paste/Cezar.jpg?raw=true" alt=""></div>
        <div class="photo-name">Sezar</div>
      </div>
      <div class="photo-item">
        <div class="photo"><img src="https://github.com/ClenaStore/barreirense/blob/main/paste/Heleninha.jpg?raw=true" alt=""></div>
        <div class="photo-name">Heleninha</div>
      </div>
      <div class="photo-item">
        <div class="photo"><img src="https://github.com/ClenaStore/barreirense/blob/main/paste/Marcus%20Aur%C3%A9lio.jpg?raw=true" alt=""></div>
        <div class="photo-name">Marcos Aur√©lio</div>
      </div>
      <div class="photo-item">
        <div class="photo"><img src="https://github.com/ClenaStore/barreirense/blob/main/paste/Maria%20de%20F%C3%A1tima.jpg?raw=true" alt=""></div>
        <div class="photo-name">Maria de F√°tima</div>
      </div>
    </div>

    <form id="f">
      <input type="hidden" id="foto">
      <label>Nome completo</label>
      <input id="nome" type="text" required placeholder="Seu nome completo">

      <label>E-mail</label>
      <input id="email" type="email" required placeholder="seu@email.com">

      <label>Telefone / WhatsApp</label>
      <input id="tel" type="tel" required maxlength="16" placeholder="(00) 00000-0000">

      <label>Quantidade de cotas</label>
      <input id="qtd" type="number" min="1" required placeholder="Ex: 3">

      <button id="enviar" class="btn" type="submit">Confirmar Participa√ß√£o</button>
    </form>

    <div id="pixBox" class="pix-box">
      <div class="pix-label">Chave PIX para pagamento:</div>
      <div id="pixKey" class="pix-key">storeclena@gmail.com</div>
      <div id="totalValor" class="total-valor"></div>
      <div id="copiedMsg" class="copied" style="display:none;">‚úÖ Chave copiada!</div>
    </div>

    <button id="whats" class="whats">üì© Enviar Comprovante pelo WhatsApp</button>
    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxaTo1yxg3EoyDoQS0Vx8JnjCgGvnwJb7PCRdQ2f1nFgGQgznT1voOriPSJOaXWHWwI/exec";
const NUMERO_WHATSAPP = "5577998253249";
const PIX_KEY = "storeclena@gmail.com";
const PRECO = 5;

const premio = document.getElementById("premio");
const fotos  = document.querySelectorAll(".photo");
const fotoH  = document.getElementById("foto");
const nome   = document.getElementById("nome");
const email  = document.getElementById("email");
const tel    = document.getElementById("tel");
const qtd    = document.getElementById("qtd");
const enviar = document.getElementById("enviar");
const msg    = document.getElementById("msg");
const whats  = document.getElementById("whats");
const pixBox = document.getElementById("pixBox");
const pixKey = document.getElementById("pixKey");
const copiedMsg = document.getElementById("copiedMsg");
const totalValor = document.getElementById("totalValor");
const overlay = document.getElementById("overlay");

// copiar chave PIX
pixKey.addEventListener("click", async ()=>{
  await navigator.clipboard.writeText(PIX_KEY);
  copiedMsg.style.display = "block";
  setTimeout(()=>copiedMsg.style.display="none",2000);
});

// m√°scara telefone
tel.addEventListener("input", (e)=>{
  let v = e.target.value.replace(/\D/g,'').slice(0,11);
  v = v.length>10 ? v.replace(/^(\d{2})(\d{5})(\d{4}).*/,'($1) $2-$3')
                  : v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/,'($1) $2-$3');
  e.target.value = v;
});

// sele√ß√£o de foto
fotos.forEach(p=>{
  p.addEventListener("click", ()=>{
    fotos.forEach(x=>x.classList.remove("sel"));
    p.classList.add("sel");
    fotoH.value = p.querySelector("img").src;
  });
});

// atualiza pr√™mio aprovado (-25%)
async function refreshPremio(){
  try{
    const r = await fetch(`${SCRIPT_URL}?action=premio`, {cache:"no-store"});
    const j = await r.json();
    premio.textContent = j.valor || "R$ 0,00";
  }catch(e){
    premio.textContent = "R$ 0,00";
  }
}
refreshPremio();
setInterval(refreshPremio, 6000);

// submit
document.getElementById("f").addEventListener("submit", async (e)=>{
  e.preventDefault();
  msg.className = "msg";
  msg.textContent = "";
  whats.style.display = "none";
  pixBox.style.display = "none";

  if(!fotoH.value){
    msg.textContent = "Selecione uma das imagens acima.";
    msg.classList.add("err");
    return;
  }

  enviar.disabled = true;
  overlay.style.display = "flex"; // mostra overlay

  const payload = {
    action:"registrar",
    nome: nome.value.trim(),
    email: email.value.trim(),
    telefone: tel.value.trim(),
    qtd: Number(qtd.value),
    foto: fotoH.value,
    valor: PRECO,
    status: "PENDENTE"
  };

  try{
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: {"Content-Type":"text/plain;charset=utf-8"},
      body: JSON.stringify(payload)
    });
    const txt = await res.text();

    if (txt.includes("OK")) {
      const total = payload.qtd * PRECO;
      msg.textContent = "‚úÖ Aposta registrada! Copie a chave PIX abaixo e envie o comprovante pelo WhatsApp.";
      msg.classList.add("ok");
      whats.style.display = "block";
      pixBox.style.display = "block";
      totalValor.textContent = `Valor a pagar: R$ ${total.toFixed(2).replace('.', ',')}`;

      whats.onclick = ()=>{
        const m = encodeURIComponent(
          `Ol√°! Enviando meu comprovante do Bol√£o da Sorte.\n\nüë§ Nome: ${payload.nome}\nüìû Telefone: ${payload.telefone}\nüìß E-mail: ${payload.email}\nüí∞ ${payload.qtd} cotas | Total: R$ ${total.toFixed(2).replace('.',',')}`
        );
        window.open(`https://wa.me/${NUMERO_WHATSAPP}?text=${m}`, "_blank");
      };

      qtd.value = "";
      fotoH.value = "";
      fotos.forEach(x=>x.classList.remove("sel"));
      refreshPremio();
    } else if (txt.includes("duplicado")) {
      msg.textContent = "‚ö†Ô∏è Este telefone j√° possui uma aposta.";
      msg.classList.add("err");
    } else {
      msg.textContent = "‚ùå Erro ao enviar. Verifique se o Web App est√° p√∫blico.";
      msg.classList.add("err");
      console.log("Resposta do GAS:", txt);
    }
  }catch(err){
    msg.textContent = "Falha de conex√£o com o Apps Script.";
    msg.classList.add("err");
    console.error(err);
  }finally{
    overlay.style.display = "none"; // esconde overlay
    enviar.disabled = false;
  }
});
</script>
</body>
</html>
