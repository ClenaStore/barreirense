<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>üéØ Jogo do Bicho</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#060818;--bg2:#0a0f2c;--panel:#0f172a;--line:#1e2a3f;
  --text:#eaf2ff;--muted:#a7b3c8;--accent:#00e5ff;--accent2:#7c3aed;
  --warn:#f59e0b;--ok:#16a34a;--bad:#ef4444;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,system-ui;
  background:radial-gradient(900px 700px at 50% -150px,var(--bg2),#020412 75%);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* ===== Cabe√ßalho ===== */
header{text-align:center;padding:22px 10px 12px}
h1{font-family:Orbitron;color:var(--warn);text-shadow:0 0 10px rgba(245,158,11,.6);font-size:28px;margin-bottom:4px}
.sub{color:var(--muted);font-size:15px}

/* ===== Painel Superior ===== */
.panel{max-width:950px;margin:14px auto;background:linear-gradient(180deg,var(--panel),#0a0f1f);
border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-wrap:wrap;
gap:8px;align-items:center;justify-content:space-between;box-shadow:0 0 22px rgba(0,229,255,.07)}
.panel .badges{display:flex;flex-wrap:wrap;gap:6px;align-items:center;flex:1;min-width:250px}
.badge{font-size:12px;background:#0b1223;border:1px solid var(--line);padding:6px 10px;border-radius:10px;color:#a7b3c8}
.price{color:var(--warn);font-weight:800}
.actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;flex:1}
.btn{border:none;border-radius:10px;padding:12px 14px;font-weight:800;cursor:pointer;transition:.25s;font-size:14px}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#06121a;box-shadow:0 0 12px rgba(0,229,255,.35)}
.btn-clear{background:#102038;color:#dbe7ff;border:1px solid var(--line)}

/* ===== Grid ===== */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;max-width:950px;margin:20px auto 60px;padding:0 14px}
.card{position:relative;border:1px solid #13213a;border-radius:14px;overflow:hidden;cursor:pointer;transition:.25s;background:#000;height:170px}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(0,229,255,.18)}
.card.selected{outline:2px solid var(--accent);box-shadow:0 0 0 4px rgba(0,229,255,.22) inset,0 0 16px rgba(0,229,255,.24)}
.card.sold{opacity:.6;cursor:not-allowed}
.card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.85)}
.nums{position:absolute;right:6px;top:6px;text-align:right;font-size:12px;line-height:1.2em;color:var(--warn);font-weight:600;text-shadow:0 0 6px rgba(0,0,0,.7)}
.name{position:absolute;bottom:6px;left:0;right:0;font-weight:700;font-size:15px;color:var(--accent);text-shadow:0 0 8px rgba(0,0,0,.9)}

/* ===== Overlay ===== */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;align-items:center;justify-content:center;flex-direction:column}
.loader{width:64px;height:64px;border-radius:50%;border:4px solid #23304a;border-top-color:var(--warn);animation:spin 1s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}.overlay p{color:#bed0ee}

/* ===== Popup ===== */
.popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;align-items:center;justify-content:center}
.box{width:min(92vw,420px);background:linear-gradient(180deg,var(--panel),#0a0f1c);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 0 18px rgba(0,229,255,.25)}
.box h3{margin:0 0 8px;color:var(--warn);font-family:Orbitron;text-align:center}
.box label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
.box input{width:100%;background:#0b1220;color:var(--text);border:none;border-radius:10px;padding:12px;font-size:15px}
.row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.ok{background:linear-gradient(90deg,var(--warn),#ffb757);color:#111}
.cancel{background:#112036;color:#c9d6ec;border:1px solid #1f2f49}

/* ===== Drawer PIX ===== */
.pix-drawer{display:none;position:fixed;left:0;right:0;bottom:0;z-index:9000;background:#0b1325;border-top:1px solid #1e2a3f;padding:12px 14px}
.pix-drawer .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.pix-key{background:#16243a;color:#eaf2ff;padding:10px 12px;border-radius:8px;font-weight:700;word-break:break-all;border:1px solid #20344f}
.copy{border:none;border-radius:8px;padding:10px 12px;background:linear-gradient(90deg,var(--accent),#5cc7ff);color:#0b1220;font-weight:800;cursor:pointer}
.close-drawer{border:none;background:#112036;color:#d7e4ff;border:1px solid #1f2f49;border-radius:8px;padding:10px 12px}
.total-line{color:#ffd089;font-weight:800;text-align:center;width:100%}

/* ===== Mobile ===== */
@media(max-width:700px){
  h1{font-size:24px}
  .panel{flex-direction:column;align-items:flex-start;gap:10px}
  .panel .actions{width:100%;justify-content:space-between}
  .btn{flex:1}
  .grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .card{height:150px}
}
</style>
</head>
<body>

<header>
  <h1>üéØ Jogo do Bicho</h1>
  <p class="sub">Selecione seus bichos ‚Äî R$ 6,00 cada</p>
</header>

<div class="panel">
  <div class="badges">
    <span class="badge">Dispon√≠veis: <b id="disp">‚Äî</b></span>
    <span class="badge">Selecionados: <b id="selCount">0</b></span>
    <span class="badge">Pre√ßo: <b class="price">R$ 6,00</b></span>
    <span class="badge">üí∞ Pr√™mio: <b id="premio">‚Äî</b></span>
  </div>
  <div class="actions">
    <button id="btnClear" class="btn btn-clear">Limpar</button>
    <button id="btnConfirm" class="btn btn-primary" disabled>Confirmar</button>
  </div>
</div>

<div id="grid" class="grid"></div>

<!-- Overlay -->
<div id="overlay" class="overlay">
  <div class="loader"></div>
  <p>Processando...</p>
</div>

<!-- Popup -->
<div id="popup" class="popup">
  <div class="box">
    <h3>Confirmar Participa√ß√£o</h3>
    <div class="badge" style="display:block;text-align:center;margin-bottom:8px">
      Bichos: <b id="numsPreview"></b> ‚Ä¢ Total: <b id="totalPreview"></b>
    </div>
    <label>Nome completo</label>
    <input id="nome" type="text" placeholder="Seu nome" required>
    <label>E-mail</label>
    <input id="email" type="email" placeholder="seu@email.com" required>
    <label>Telefone / WhatsApp</label>
    <input id="tel" type="tel" placeholder="(00) 00000-0000" maxlength="16" required>
    <div class="row">
      <button id="confirm" class="btn ok" type="button">Enviar</button>
      <button id="cancel" class="btn cancel" type="button">Cancelar</button>
    </div>
  </div>
</div>

<!-- Drawer PIX -->
<div id="pixDrawer" class="pix-drawer">
  <div class="row">
    <div class="total-line">Valor total: <span id="pixTotal"></span></div>
    <div class="pix-key" id="pixKeyBox"></div>
  </div>
  <div class="row" style="margin-top:8px">
    <button class="copy" id="copyPix">Copiar chave PIX</button>
    <button class="close-drawer" id="closeDrawer">Fechar</button>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbxqUX_W6Jv-yUZ3CcoDBWF5bEO5RgsSOttQUnu3kXX2qqX62Cx59EJgtRJui8R5rQN3kg/exec";
const PRECO=6,PIX_KEY="711e433b-bb4e-477e-adb7-518eacf2f67e";

const bichos=[
["Avestruz","01","02","03","04","https://github.com/ClenaStore/barreirense/blob/main/paste/avestruz.png?raw=true"],
["√Åguia","05","06","07","08","https://github.com/ClenaStore/barreirense/blob/main/paste/%C3%A1guia.png?raw=true"],
["Burro","09","10","11","12","https://github.com/ClenaStore/barreirense/blob/main/paste/BURRO.png?raw=true"],
["Borboleta","13","14","15","16","https://github.com/ClenaStore/barreirense/blob/main/paste/BORBOLETA.png?raw=true"],
["Cachorro","17","18","19","20","https://github.com/ClenaStore/barreirense/blob/main/paste/CACHORRO.png?raw=true"],
["Cabra","21","22","23","24","https://github.com/ClenaStore/barreirense/blob/main/paste/CARNEIRO.png?raw=true"],
["Carneiro","25","26","27","28","https://github.com/ClenaStore/barreirense/blob/main/paste/CARNEIRO%20(2).png?raw=true"],
["Camelo","29","30","31","32","https://github.com/ClenaStore/barreirense/blob/main/paste/CAMELO.png?raw=true"],
["Cobra","33","34","35","36","https://github.com/ClenaStore/barreirense/blob/main/paste/COBRA.png?raw=true"],
["Coelho","37","38","39","40","https://github.com/ClenaStore/barreirense/blob/main/paste/COELHO.png?raw=true"],
["Cavalo","41","42","43","44","https://github.com/ClenaStore/barreirense/blob/main/paste/CAVALO.png?raw=true"],
["Elefante","45","46","47","48","https://github.com/ClenaStore/barreirense/blob/main/paste/ELEFANTE.png?raw=true"],
["Galo","49","50","51","52","https://github.com/ClenaStore/barreirense/blob/main/paste/GALO.png?raw=true"],
["Gato","53","54","55","56","https://github.com/ClenaStore/barreirense/blob/main/paste/GATO.png?raw=true"],
["Jacar√©","57","58","59","60","https://github.com/ClenaStore/barreirense/blob/main/paste/JACARE.png?raw=true"],
["Le√£o","61","62","63","64","https://github.com/ClenaStore/barreirense/blob/main/paste/LEAO.png?raw=true"],
["Macaco","65","66","67","68","https://github.com/ClenaStore/barreirense/blob/main/paste/MACACO.png?raw=true"],
["Porco","69","70","71","72","https://github.com/ClenaStore/barreirense/blob/main/paste/PORCO.png?raw=true"],
["Pav√£o","73","74","75","76","https://github.com/ClenaStore/barreirense/blob/main/paste/PAV%C3%83O.png?raw=true"],
["Peru","77","78","79","80","https://github.com/ClenaStore/barreirense/blob/main/paste/PERU.png?raw=true"],
["Touro","81","82","83","84","https://github.com/ClenaStore/barreirense/blob/main/paste/TOURO.png?raw=true"],
["Tigre","85","86","87","88","https://github.com/ClenaStore/barreirense/blob/main/paste/TIGRE.png?raw=true"],
["Urso","89","90","91","92","https://github.com/ClenaStore/barreirense/blob/main/paste/URSO.png?raw=true"],
["Veado","93","94","95","96","https://github.com/ClenaStore/barreirense/blob/main/paste/VEADO.png?raw=true"],
["Vaca","97","98","99","00","https://github.com/ClenaStore/barreirense/blob/main/paste/VACA.png?raw=true"]
];

const grid=document.getElementById("grid"),dispEl=document.getElementById("disp"),
selCountEl=document.getElementById("selCount"),premioEl=document.getElementById("premio"),
overlay=document.getElementById("overlay"),popup=document.getElementById("popup"),
pixDrawer=document.getElementById("pixDrawer"),pixTotalEl=document.getElementById("pixTotal"),
pixKeyBox=document.getElementById("pixKeyBox"),copyPix=document.getElementById("copyPix"),
closeDrawer=document.getElementById("closeDrawer"),btnConfirm=document.getElementById("btnConfirm"),
btnClear=document.getElementById("btnClear");

let vendidos=new Set(),selecionados=new Set(),totalPago=0;

function updatePanel(){
  selCountEl.textContent=selecionados.size;
  btnConfirm.disabled=selecionados.size===0;
  const premio=(totalPago*0.6).toFixed(2);
  premioEl.textContent=`R$ ${premio}`;
}

// Renderiza tudo uma vez
function renderGrid(){
  grid.innerHTML=bichos.map(([nome,n1,n2,n3,n4,img])=>`
  <div class="card" data-nome="${nome}">
    <img loading="lazy" src="${img}" alt="${nome}">
    <div class="nums">${n1}<br>${n2}<br>${n3}<br>${n4}</div>
    <div class="name">${nome}</div>
  </div>`).join('');
  document.querySelectorAll(".card").forEach(c=>{
    c.addEventListener("click",()=>{
      const nome=c.dataset.nome;
      if(vendidos.has(nome))return;
      if(selecionados.has(nome)){selecionados.delete(nome);c.classList.remove("selected");}
      else{selecionados.add(nome);c.classList.add("selected");}
      updatePanel();
    });
  });
}

async function loadVendidos(){
  try{
    const r=await fetch(`${SCRIPT_URL}?action=vendidos`,{cache:"no-store"});
    const j=await r.json();
    vendidos=new Set(j.vendidos||[]);
    totalPago=j.totalPago||0;
    document.querySelectorAll(".card").forEach(c=>{
      if(vendidos.has(c.dataset.nome))c.classList.add("sold");
    });
    dispEl.textContent=bichos.length-vendidos.size;
  }catch(e){dispEl.textContent=bichos.length;}
}

renderGrid();
loadVendidos();

btnClear.onclick=()=>{selecionados.clear();document.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));updatePanel();};
btnConfirm.onclick=()=>{
  const arr=[...selecionados];
  document.getElementById("numsPreview").textContent=arr.join(", ");
  document.getElementById("totalPreview").textContent=`R$ ${(arr.length*PRECO).toFixed(2)}`;
  popup.style.display="flex";
};
document.getElementById("cancel").onclick=()=>popup.style.display="none";

document.getElementById("confirm").onclick=async()=>{
  const nome=document.getElementById("nome").value.trim(),email=document.getElementById("email").value.trim(),tel=document.getElementById("tel").value.trim();
  const arr=[...selecionados];
  if(!nome||!email||!tel||arr.length===0){alert("Preencha todos os campos.");return;}
  overlay.style.display="flex";
  try{
    const res=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},
      body:JSON.stringify({action:"registrar_rifa",nome,email,telefone:tel,bichos:arr,total:arr.length*PRECO,pix:PIX_KEY})});
    const text=await res.text();overlay.style.display="none";
    if(/OK/i.test(text)){popup.style.display="none";openDrawer(arr.length*PRECO);selecionados.clear();
      document.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));loadVendidos();}
    else alert("Erro ao enviar.");
  }catch{overlay.style.display="none";alert("Falha de conex√£o.");}
};

function openDrawer(total){pixDrawer.style.display="block";pixTotalEl.textContent=`R$ ${total.toFixed(2)}`;pixKeyBox.textContent=PIX_KEY;}
copyPix.onclick=async()=>{await navigator.clipboard.writeText(PIX_KEY);copyPix.textContent="Copiado!";setTimeout(()=>copyPix.textContent="Copiar chave PIX",1500);}
closeDrawer.onclick=()=>pixDrawer.style.display="none";
</script>
</body>
</html>
