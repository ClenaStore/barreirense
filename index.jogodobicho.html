<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>ðŸŽ¯ Jogo do Bicho</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#060818;--bg2:#0a0f2c;--panel:#0f172a;--line:#1e2a3f;
  --text:#eaf2ff;--muted:#a7b3c8;--accent:#00e5ff;--accent2:#7c3aed;
  --warn:#f59e0b;--ok:#16a34a;--bad:#ef4444;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,system-ui;
  background:radial-gradient(900px 700px at 50% -150px,var(--bg2),#020412 75%);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}
header{text-align:center;padding:22px 10px 12px}
h1{font-family:Orbitron;color:var(--warn);text-shadow:0 0 10px rgba(245,158,11,.6);font-size:28px;margin-bottom:4px}
.sub{color:var(--muted);font-size:15px}

/* Painel superior */
.panel{
  max-width:950px;margin:14px auto;background:linear-gradient(180deg,var(--panel),#0a0f1f);
  border:1px solid var(--line);border-radius:16px;padding:12px 14px;
  display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;
  box-shadow:0 0 22px rgba(0,229,255,.07)
}
.badge{font-size:12px;background:#0b1223;border:1px solid var(--line);padding:6px 10px;border-radius:10px;color:#a7b3c8}
.price{color:var(--warn);font-weight:800}
.actions{display:flex;gap:10px;flex-wrap:wrap}
.btn{border:none;border-radius:10px;padding:12px 14px;font-weight:800;cursor:pointer;transition:.25s;font-size:14px}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#06121a;box-shadow:0 0 12px rgba(0,229,255,.35)}
.btn-clear{background:#102038;color:#dbe7ff;border:1px solid var(--line)}

/* Grid */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:12px;
  max-width:950px;
  margin:20px auto 60px;
  padding:0 14px;
}
.card{
  background:linear-gradient(180deg,#0c152b,#0a1020);
  border:1px solid #13213a;
  border-radius:14px;
  text-align:center;
  overflow:hidden;
  padding:8px;
  cursor:pointer;
  position:relative;
  transition:.25s;
}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(0,229,255,.18),inset 0 0 0 2px rgba(0,229,255,.18)}
.card.selected{outline:2px solid var(--accent);box-shadow:0 0 0 4px rgba(0,229,255,.22) inset,0 0 16px rgba(0,229,255,.24)}
.card.sold{opacity:.6;cursor:not-allowed}
.name{font-weight:700;font-size:15px;color:var(--accent);text-shadow:0 0 6px rgba(0,229,255,.3);margin-top:4px}
.nums{
  position:absolute;
  right:6px;top:6px;
  text-align:right;
  font-size:12px;
  line-height:1.2em;
  color:var(--warn);
  font-weight:600;
}
.card img{
  width:100%;
  height:110px;
  object-fit:contain;
  object-position:top center;
  margin-top:0;
  filter:drop-shadow(0 0 6px rgba(0,229,255,.25));
}

/* Overlay */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;align-items:center;justify-content:center;flex-direction:column}
.loader{width:64px;height:64px;border-radius:50%;border:4px solid #23304a;border-top-color:var(--warn);animation:spin 1s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}.overlay p{color:#bed0ee}

/* Popup */
.popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;align-items:center;justify-content:center}
.box{width:min(92vw,420px);background:linear-gradient(180deg,var(--panel),#0a0f1c);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 0 18px rgba(0,229,255,.25)}
.box h3{margin:0 0 8px;color:var(--warn);font-family:Orbitron;text-align:center}
.box label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
.box input{width:100%;background:#0b1220;color:var(--text);border:none;border-radius:10px;padding:12px;font-size:15px}
.row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.ok{background:linear-gradient(90deg,var(--warn),#ffb757);color:#111}
.cancel{background:#112036;color:#c9d6ec;border:1px solid #1f2f49}

/* Drawer PIX */
.pix-drawer{display:none;position:fixed;left:0;right:0;bottom:0;z-index:9000;background:#0b1325;border-top:1px solid #1e2a3f;padding:12px 14px}
.pix-drawer .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.pix-key{background:#16243a;color:#eaf2ff;padding:10px 12px;border-radius:8px;font-weight:700;word-break:break-all;border:1px solid #20344f}
.copy{border:none;border-radius:8px;padding:10px 12px;background:linear-gradient(90deg,var(--accent),#5cc7ff);color:#0b1220;font-weight:800;cursor:pointer}
.close-drawer{border:none;background:#112036;color:#d7e4ff;border:1px solid #1f2f49;border-radius:8px;padding:10px 12px}
.total-line{color:#ffd089;font-weight:800;text-align:center;width:100%}

/* mobile tweaks */
@media(max-width:600px){
  .grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .card img{height:80px}
  h1{font-size:22px}
  .panel{flex-direction:column;align-items:flex-start}
  .btn{flex:1}
  .nums{font-size:11px;right:4px}
}
</style>
</head>
<body>

<header>
  <h1>ðŸŽ¯ Jogo do Bicho</h1>
  <p class="sub">Selecione seus bichos â€” R$ 6,00 cada</p>
</header>

<div class="panel">
  <div>
    <span class="badge">DisponÃ­veis: <b id="disp">â€”</b></span>
    <span class="badge">Selecionados: <b id="selCount">0</b></span>
    <span class="badge">PreÃ§o: <b class="price">R$ 6,00</b></span>
    <span class="badge">ðŸ’° PrÃªmio: <b id="premio">â€”</b></span>
  </div>
  <div class="actions">
    <button id="btnClear" class="btn btn-clear">Limpar</button>
    <button id="btnConfirm" class="btn btn-primary" disabled>Confirmar</button>
  </div>
</div>

<div class="grid" id="grid"></div>

<!-- Overlay -->
<div id="overlay" class="overlay">
  <div class="loader"></div>
  <p>Processando...</p>
</div>

<!-- Popup -->
<div id="popup" class="popup">
  <div class="box">
    <h3>Confirmar ParticipaÃ§Ã£o</h3>
    <div class="badge" style="display:block;text-align:center;margin-bottom:8px">
      Bichos: <b id="numsPreview"></b> â€¢ Total: <b id="totalPreview"></b>
    </div>
    <label>Nome completo</label>
    <input id="nome" type="text" placeholder="Seu nome" required>
    <label>E-mail</label>
    <input id="email" type="email" placeholder="seu@email.com" required>
    <label>Telefone / WhatsApp</label>
    <input id="tel" type="tel" placeholder="(00) 00000-0000" maxlength="16" required>
    <div class="row">
      <button id="confirm" class="btn ok" type="button">Enviar</button>
      <button id="cancel" class="btn cancel" type="button">Cancelar</button>
    </div>
  </div>
</div>

<!-- Drawer PIX -->
<div id="pixDrawer" class="pix-drawer">
  <div class="row">
    <div class="total-line">Valor total: <span id="pixTotal"></span></div>
    <div class="pix-key" id="pixKeyBox"></div>
  </div>
  <div class="row" style="margin-top:8px">
    <button class="copy" id="copyPix">Copiar chave PIX</button>
    <button class="close-drawer" id="closeDrawer">Fechar</button>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbxqUX_W6Jv-yUZ3CcoDBWF5bEO5RgsSOttQUnu3kXX2qqX62Cx59EJgtRJui8R5rQN3kg/exec";
const PRECO=6;
const PIX_KEY="711e433b-bb4e-477e-adb7-518eacf2f67e";

const bichos=[
["Avestruz","01","02","03","04","https://i.imgur.com/4UfbKQP.png"],
["Ãguia","05","06","07","08","https://i.imgur.com/Q12H25S.png"],
["Burro","09","10","11","12","https://i.imgur.com/lNsDxWr.png"],
["Borboleta","13","14","15","16","https://i.imgur.com/6g3bE1S.png"],
["Cachorro","17","18","19","20","https://i.imgur.com/pttBf7Z.png"],
["Cabra","21","22","23","24","https://i.imgur.com/7QlRcf7.png"],
["Carneiro","25","26","27","28","https://i.imgur.com/dm1ckEi.png"],
["Camelo","29","30","31","32","https://i.imgur.com/MzjNP7W.png"],
["Cobra","33","34","35","36","https://i.imgur.com/Nx1OiAM.png"],
["Coelho","37","38","39","40","https://i.imgur.com/jyPLawK.png"],
["Cavalo","41","42","43","44","https://i.imgur.com/fm6oA5C.png"],
["Elefante","45","46","47","48","https://i.imgur.com/GwS1nLD.png"],
["Galo","49","50","51","52","https://i.imgur.com/rX1Kyeb.png"],
["Gato","53","54","55","56","https://i.imgur.com/l4uQ8Ld.png"],
["JacarÃ©","57","58","59","60","https://i.imgur.com/BuE2ZFl.png"],
["LeÃ£o","61","62","63","64","https://i.imgur.com/dL22sKm.png"],
["Macaco","65","66","67","68","https://i.imgur.com/LH4CAXD.png"],
["Porco","69","70","71","72","https://i.imgur.com/l8aXkzl.png"],
["PavÃ£o","73","74","75","76","https://i.imgur.com/aYYIcsR.png"],
["Peru","77","78","79","80","https://i.imgur.com/f9v7vTV.png"],
["Touro","81","82","83","84","https://i.imgur.com/d0AM7Lr.png"],
["Tigre","85","86","87","88","https://i.imgur.com/JleKmuR.png"],
["Urso","89","90","91","92","https://i.imgur.com/Jts7lL7.png"],
["Veado","93","94","95","96","https://i.imgur.com/1LqJixU.png"],
["Vaca","97","98","99","00","https://i.imgur.com/bIMqKu5.png"]
];

const grid=document.getElementById("grid");
const dispEl=document.getElementById("disp"),selCountEl=document.getElementById("selCount"),premioEl=document.getElementById("premio");
const overlay=document.getElementById("overlay"),popup=document.getElementById("popup");
const nomeEl=document.getElementById("nome"),emailEl=document.getElementById("email"),telEl=document.getElementById("tel");
const numsPreview=document.getElementById("numsPreview"),totalPreview=document.getElementById("totalPreview");
const pixDrawer=document.getElementById("pixDrawer"),pixTotalEl=document.getElementById("pixTotal"),pixKeyBox=document.getElementById("pixKeyBox");
const copyPix=document.getElementById("copyPix"),closeDrawer=document.getElementById("closeDrawer");
const btnConfirm=document.getElementById("btnConfirm"),btnClear=document.getElementById("btnClear");

let vendidos=new Set(),selecionados=new Set(),totalPago=0;

function showOverlay(s){overlay.style.display=s?'flex':'none'}
function openPopup(){popup.style.display='flex';setTimeout(()=>nomeEl.focus(),50)}
function closePopup(){popup.style.display='none'}
function openDrawer(total){pixTotalEl.textContent=`R$ ${total.toFixed(2)}`;pixKeyBox.textContent=PIX_KEY;pixDrawer.style.display="block"}
function closePixDrawer(){pixDrawer.style.display="none"}

function renderGrid(){
  grid.innerHTML='';let disponiveis=0;
  bichos.forEach(([nome,n1,n2,n3,n4,img])=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`<div class="nums">${n1}<br>${n2}<br>${n3}<br>${n4}</div>
                 <img src="${img}" alt="${nome}">
                 <div class="name">${nome}</div>`;
    if(vendidos.has(nome)){c.classList.add('sold')}
    else{
      disponiveis++;
      if(selecionados.has(nome))c.classList.add('selected');
      c.addEventListener('click',()=>{
        if(selecionados.has(nome))selecionados.delete(nome);
        else selecionados.add(nome);
        renderGrid();
        updatePanel();
      });
    }
    grid.appendChild(c);
  });
  dispEl.textContent=disponiveis;
}

function updatePanel(){
  selCountEl.textContent=selecionados.size;
  btnConfirm.disabled=selecionados.size===0;
  const premio=(totalPago*0.6).toFixed(2);
  premioEl.textContent=`R$ ${premio}`;
}

async function loadVendidos(){
  try{
    const r=await fetch(`${SCRIPT_URL}?action=vendidos`);
    const j=await r.json();
    vendidos=new Set(j.vendidos||[]);
    totalPago=j.totalPago||0;
  }catch(e){vendidos=new Set();totalPago=0;}
}

async function init(){await loadVendidos();renderGrid();updatePanel();}
init();

btnClear.addEventListener('click',()=>{selecionados.clear();renderGrid();updatePanel();});
btnConfirm.addEventListener('click',()=>{
  const arr=Array.from(selecionados);
  numsPreview.textContent=arr.join(', ');
  totalPreview.textContent=`R$ ${(arr.length*PRECO).toFixed(2)}`;
  openPopup();
});
document.getElementById('cancel').addEventListener('click',closePopup);

document.getElementById('confirm').addEventListener('click',async()=>{
  const nome=nomeEl.value.trim(),email=emailEl.value.trim(),tel=telEl.value.trim();
  const arr=Array.from(selecionados);
  if(!nome||!email||!tel||arr.length===0){alert('Preencha os dados e selecione ao menos 1 bicho.');return;}
  showOverlay(true);
  try{
    const payload={action:"registrar_rifa",nome,email,telefone:tel,bichos:arr,total:arr.length*PRECO,pix:PIX_KEY};
    const res=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(payload)});
    const text=await res.text();
    showOverlay(false);
    if(/OK/i.test(text)){closePopup();openDrawer(arr.length*PRECO);selecionados.clear();await loadVendidos();renderGrid();updatePanel();}
    else alert('Erro ao enviar.');
  }catch(e){showOverlay(false);alert('Falha de conexÃ£o.');}
});
copyPix.addEventListener('click',async()=>{await navigator.clipboard.writeText(PIX_KEY);copyPix.textContent="Copiado!";setTimeout(()=>copyPix.textContent="Copiar chave PIX",1500);});
closeDrawer.addEventListener('click',closePixDrawer);
</script>
</body>
</html>
