<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üéüÔ∏è Rifa Solid√°ria</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#060818; --bg2:#0a0f2c; --panel:#0f172a; --line:#1e2a3f;
  --text:#eaf2ff; --muted:#a7b3c8; --accent:#00e5ff; --accent2:#7c3aed; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
}
*{box-sizing:border-box} body{margin:0;background:radial-gradient(900px 700px at 50% -150px,var(--bg2),#020412 75%);color:var(--text);font-family:Inter,system-ui}
.wrap{max-width:980px;margin:0 auto;padding:12px 14px 80px}

/* ===== Banner (8 itens) ===== */
.banner{
  position:relative;height:190px;margin-bottom:14px;border-bottom:1px solid rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#0b1334,transparent);overflow:hidden
}
.banner img{max-height:170px;object-fit:contain;filter:drop-shadow(0 0 16px rgba(0,229,255,.55));transition:opacity .6s ease}

/* selo do pr√™mio */
.prize{position:absolute;left:10px;top:10px;display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0c1633cc;border:1px solid #1d2a44;border-radius:12px;backdrop-filter:blur(4px)}
.prize .place{display:inline-block;background:linear-gradient(90deg,#f59e0b,#ffd089);color:#111;padding:6px 10px;border-radius:999px;font-weight:900;box-shadow:0 0 10px rgba(245,158,11,.45)}
.prize .name{font-weight:700;color:#eaf2ff;letter-spacing:.2px}
.prize small{display:block;color:#a8b3c7;font-weight:600;margin-top:2px}

/* navega√ß√£o + bolinhas */
.banner .nav{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;padding:0 8px}
.banner .nav button{
  width:36px;height:36px;border:none;border-radius:50%;background:#0e1a33a8;color:#cfe3ff;cursor:pointer;backdrop-filter:blur(4px)
}
.banner .dots{position:absolute;bottom:8px;left:0;right:0;display:flex;gap:6px;justify-content:center}
.banner .dots span{width:6px;height:6px;border-radius:50%;background:#93a7c2;opacity:.45}
.banner .dots .on{opacity:1;background:#fff}

/* ===== T√≠tulo e painel ===== */
h1{font-family:Orbitron;margin:10px 0 6px;text-align:center;color:var(--warn);text-shadow:0 0 10px rgba(245,158,11,.6);font-size:26px}
.sub{text-align:center;color:var(--muted);margin-bottom:12px}
.panel{
  background:linear-gradient(180deg,var(--panel),#0a0f1f);border:1px solid var(--line);border-radius:16px;padding:12px;
  display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;box-shadow:0 0 22px rgba(0,229,255,.07)
}
.badge{font-size:12px;background:#0b1223;border:1px solid var(--line);padding:6px 10px;border-radius:10px;color:#a7b3c8}
.price{color:var(--warn);font-weight:800}
.actions{display:flex;gap:10px}
.btn{border:none;border-radius:10px;padding:12px 14px;font-weight:800;cursor:pointer;transition:.25s;font-size:14px}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent)); color:#06121a; box-shadow:0 0 12px rgba(0,229,255,.35)}
.btn-primary:disabled{filter:grayscale(1) brightness(.6); cursor:not-allowed; box-shadow:none}
.btn-clear{background:#102038;color:#dbe7ff;border:1px solid var(--line)}
.hint{font-size:12px;color:var(--muted);margin-top:6px}

/* ===== Grid de n√∫meros (cart√µes neon) ===== */
.grid{margin-top:14px; display:grid; grid-template-columns:repeat(5,1fr); gap:10px}
@media(min-width:768px){ .grid{grid-template-columns:repeat(10,1fr)} }
.cell{
  position:relative; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg,#0c152b,#0a1020); border:1px solid #13213a; color:#e1ecff; border-radius:14px; font-weight:800;
  user-select:none; cursor:pointer; transition:.2s; font-size:16px; text-shadow:0 0 6px rgba(0,229,255,.25);
  box-shadow:inset 0 0 0 2px rgba(0,229,255,.06);
}
.cell:hover{transform:translateY(-2px); box-shadow:0 8px 18px rgba(0,229,255,.16), inset 0 0 0 2px rgba(0,229,255,.14)}
.cell.selected{outline:2px solid var(--accent); box-shadow:0 0 0 4px rgba(0,229,255,.22) inset, 0 0 16px rgba(0,229,255,.24)}
.cell.sold{background:#1a2336;color:#8793aa;border-color:#22314e; cursor:not-allowed; opacity:.85}
.cell.sold::after{
  content:"VEND"; position:absolute; bottom:6px; right:6px; font-size:10px; padding:2px 6px; border-radius:6px;
  background:#2a334a; color:#aab6cc; border:1px solid #334462;
}

/* ===== Overlay + Popup ===== */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;align-items:center;justify-content:center;flex-direction:column}
.loader{width:64px;height:64px;border-radius:50%;border:4px solid #23304a;border-top-color:var(--warn);animation:spin 1s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}} .overlay p{color:#bed0ee}

.popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;align-items:center;justify-content:center}
.box{
  width:min(92vw,420px); background:linear-gradient(180deg,var(--panel),#0a0f1c);
  border:1px solid var(--line); border-radius:14px; padding:16px; box-shadow:0 0 18px rgba(0,229,255,.25)
}
.box h3{margin:0 0 8px;color:var(--warn);font-family:Orbitron;text-align:center}
.box label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
.box input{width:100%;background:#0b1220;color:var(--text);border:none;border-radius:10px;padding:12px;font-size:15px}
.row{display:flex;gap:10px;margin-top:12px}
.ok{background:linear-gradient(90deg,var(--warn),#ffb757);color:#111}
.cancel{background:#112036;color:#c9d6ec;border:1px solid #1f2f49}
.small{font-size:12px;color:#a7b3c8;text-align:center;margin-top:8px}

/* ===== PIX Drawer ===== */
.pix-drawer{display:none; position:fixed; left:0; right:0; bottom:0; z-index:9000;background:#0b1325; border-top:1px solid #1e2a3f; padding:12px 14px; box-shadow:0 -10px 30px rgba(0,0,0,.45)}
.pix-drawer .row{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
.pix-key{background:#16243a;color:#eaf2ff;padding:10px 12px;border-radius:8px;font-weight:700;word-break:break-all;border:1px solid #20344f}
.copy{border:none;border-radius:8px;padding:10px 12px;background:linear-gradient(90deg,var(--accent),#5cc7ff);color:#0b1220;font-weight:800;cursor:pointer}
.total-line{color:#ffd089;font-weight:800}
.close-drawer{border:none;background:#112036;color:#d7e4ff;border:1px solid #1f2f49;border-radius:8px;padding:10px 12px}

/* Mobile tweaks */
@media(max-width:480px){
  .banner{height:170px}
  .prize{left:8px;top:8px;padding:6px}
  .prize .name{font-size:13px}
  h1{font-size:24px}
  .btn{padding:11px 12px}
  .badge{padding:5px 8px}
}
</style>
</head>
<body>

<!-- ===== 8 BANNERS ===== -->
<div class="banner" id="banner">
  <img id="bannerImg" src="" alt="Rifa banner">
  <!-- selo do pr√™mio -->
  <div class="prize" id="prizeBox">
    <span class="place" id="prizePlace">1¬∫ LUGAR</span>
    <div>
      <div class="name" id="prizeName">Pr√™mio</div>
      <small id="prizeSub">Clique nas setas para ver os demais</small>
    </div>
  </div>
  <div class="nav">
    <button id="prev" aria-label="Anterior">‚Äπ</button>
    <button id="next" aria-label="Pr√≥ximo">‚Ä∫</button>
  </div>
  <div class="dots" id="dots"></div>
</div>

<div class="wrap">
  <h1>Rifa Solid√°ria</h1>
  <p class="sub">Selecione os n√∫meros. Valor por n√∫mero: <b>R$ <span id="precoLabel">10,00</span></b>.</p>

  <div class="panel">
    <div>
      <span class="badge">Dispon√≠veis: <b id="disp">‚Äî</b></span>
      <span class="badge">Selecionados: <b id="selCount">0</b></span>
      <span class="badge">Pre√ßo: <span class="price" id="precoTop">R$ 10,00</span></span>
    </div>
    <div class="actions">
      <button id="btnClear" class="btn btn-clear" type="button">Limpar sele√ß√£o</button>
      <button id="btnConfirm" class="btn btn-primary" type="button" disabled>Confirmar participa√ß√£o</button>
    </div>
  </div>

  <!-- Grid -->
  <div id="grid" class="grid" aria-live="polite"></div>
  <p class="hint">* N√∫meros marcados como ‚ÄúVEND‚Äù j√° n√£o podem ser escolhidos.</p>
</div>

<!-- Overlay -->
<div id="overlay" class="overlay">
  <div class="loader"></div>
  <p>Processando...</p>
</div>

<!-- Popup -->
<div id="popup" class="popup" role="dialog" aria-modal="true">
  <div class="box">
    <h3>Confirmar participa√ß√£o</h3>
    <p class="small">Revise seus n√∫meros e preencha seus dados.</p>
    <div class="badge" style="display:block;text-align:center;margin-bottom:8px">
      Seus n√∫meros: <b id="numsPreview"></b> ‚Ä¢ Total: <b id="totalPreview"></b>
    </div>
    <label>Nome completo</label>
    <input id="nome" type="text" placeholder="Seu nome" required>
    <label>E-mail</label>
    <input id="email" type="email" placeholder="seu@email.com" required>
    <label>Telefone / WhatsApp</label>
    <input id="tel" type="tel" placeholder="(00) 00000-0000" maxlength="16" required>
    <div class="row">
      <button id="confirm" class="btn ok" type="button">Enviar</button>
      <button id="cancel" class="btn cancel" type="button">Cancelar</button>
    </div>
    <p class="small">Ap√≥s o envio, seus n√∫meros ser√£o reservados e voc√™ receber√° e-mail com instru√ß√µes de pagamento.</p>
  </div>
</div>

<!-- Drawer PIX -->
<div id="pixDrawer" class="pix-drawer">
  <div class="row">
    <div class="total-line">Valor total: <span id="pixTotal"></span></div>
    <div class="pix-key" id="pixKeyBox"></div>
  </div>
  <div class="row" style="margin-top:8px">
    <button class="copy" id="copyPix">Copiar chave PIX</button>
    <button class="close-drawer" id="closeDrawer">Fechar</button>
  </div>
</div>

<script>
/* ========= CONFIG ========= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx7Bq_OXa2pgNSuVD6o7KJJQsLIbZo4jhBpKTsWA5TOBSuAVO6o2B1P3Ga-BI57SHlteQ/exec"; // sua URL do GAS
const TOTAL_NUMEROS = 200;
const PRECO = 10; // R$ por n√∫mero
const PIX_KEY = "77998556393"; // sua chave PIX

/* ========= BANNERS (1..8) =========
   Troque img e name conforme seus pr√™mios */
const banners = [
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/1.png?raw=true", place:"1¬∫ LUGAR", name:"Realme note 60"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/2.png?raw=true", place:"2¬∫ LUGAR", name:"Capacete Pro Tork"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/6.png?raw=true".replace('httpsum','https://pics'), place:"3¬∫ LUGAR", name:"Perfume Zadeh"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/7.png?raw=true", place:"4¬∫ LUGAR", name:"Moletom Rally"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/3.png?raw=true", place:"5¬∫ LUGAR", name:"Ta√ßa Personalizada"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/4.png?raw=true", place:"6¬∫ LUGAR", name:"Copo T√©rmico Stanley"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/5.png?raw=true", place:"7¬∫ LUGAR", name:" Copo Stanley Laranja"},
  {img:"https://github.com/ClenaStore/barreirense/blob/main/paste/8.png?raw=true", place:"8¬∫ LUGAR", name:"Natura Tododia"}
];

/* ========= STATE ========= */
const gridEl = document.getElementById('grid');
const btnConfirm = document.getElementById('btnConfirm');
const btnClear = document.getElementById('btnClear');
const selCountEl = document.getElementById('selCount');
const dispEl = document.getElementById('disp');
const precoTopEl = document.getElementById('precoTop');
const precoLabel = document.getElementById('precoLabel');

const overlay = document.getElementById('overlay');
const popup = document.getElementById('popup');
const numsPreview = document.getElementById('numsPreview');
const totalPreview = document.getElementById('totalPreview');
const nomeEl = document.getElementById('nome');
const emailEl = document.getElementById('email');
const telEl = document.getElementById('tel');
const confirmEl = document.getElementById('confirm');
const cancelEl = document.getElementById('cancel');

const pixDrawer = document.getElementById('pixDrawer');
const pixTotalEl = document.getElementById('pixTotal');
const pixKeyBox = document.getElementById('pixKeyBox');
const copyPix = document.getElementById('copyPix');
const closeDrawer = document.getElementById('closeDrawer');

/* banner UI refs */
const bannerImg  = document.getElementById('bannerImg');
const prizePlace = document.getElementById('prizePlace');
const prizeName  = document.getElementById('prizeName');
const prizeSub   = document.getElementById('prizeSub');
const dots = document.getElementById('dots');
const prev = document.getElementById('prev');
const next = document.getElementById('next');

let vendidos = new Set();
let selecionados = new Set();
let bIndex = 0, bTimer;

/* ========= HELPERS ========= */
const fmt = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

function showOverlay(s){overlay.style.display = s ? 'flex':'none'}
function openPopup(){popup.style.display='flex'; setTimeout(()=>nomeEl.focus(),50)}
function closePopup(){popup.style.display='none'}
function openDrawer(total){
  pixTotalEl.textContent = fmt(total);
  pixKeyBox.textContent = PIX_KEY;
  pixDrawer.style.display = "block";
}
function closePixDrawer(){pixDrawer.style.display = "none"}

function renderGrid(){
  gridEl.innerHTML = '';
  let disponiveis = 0;
  for(let n=1;n<=TOTAL_NUMEROS;n++){
    const cell = document.createElement('button');
    cell.type = 'button';
    cell.className = 'cell';
    cell.textContent = n;
    const isSold = vendidos.has(n);
    if(isSold){
      cell.classList.add('sold');
      cell.disabled = true;
    }else{
      disponiveis++;
      if(selecionados.has(n)) cell.classList.add('selected');
      cell.addEventListener('click',()=>{
        if(selecionados.has(n)) selecionados.delete(n);
        else selecionados.add(n);
        updatePanel();
        cell.classList.toggle('selected');
      });
    }
    gridEl.appendChild(cell);
  }
  dispEl.textContent = disponiveis;
}

function updatePanel(){
  selCountEl.textContent = selecionados.size;
  btnConfirm.disabled = selecionados.size === 0;
  precoTopEl.textContent = `${fmt(PRECO)} ‚Ä¢ Total: ${fmt(PRECO * selecionados.size)}`;
  precoLabel.textContent = PRECO.toLocaleString('pt-BR',{minimumFractionDigits:2});
}

/* ====== TELEFONE M√ÅSCARA ====== */
telEl.addEventListener('input', e=>{
  let v = e.target.value.replace(/\D/g,'').slice(0,11);
  v = v.length>10 ? v.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3')
                  : v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
  e.target.value = v;
});

/* ====== LOAD ====== */
async function loadVendidos(){
  try{
    const r = await fetch(`${SCRIPT_URL}?action=vendidos`, {cache:'no-store'});
    if(!r.ok) throw 0;
    const j = await r.json();
    if(Array.isArray(j)) vendidos = new Set(j.map(x=>Number(x)));
  }catch(e){
    vendidos = new Set([7,12,33,40,101,150]); // demo
  }
}

async function init(){
  precoTopEl.textContent = fmt(PRECO);
  precoLabel.textContent = PRECO.toLocaleString('pt-BR',{minimumFractionDigits:2});
  await loadVendidos();
  renderGrid();
  updatePanel();
  initBanners();
}
init();

/* ====== A√á√ïES ====== */
btnClear.addEventListener('click', ()=>{
  selecionados.clear();
  updatePanel();
  renderGrid();
});

btnConfirm.addEventListener('click', ()=>{
  const arr = Array.from(selecionados).sort((a,b)=>a-b);
  numsPreview.textContent = arr.join(', ');
  totalPreview.textContent = fmt(arr.length * PRECO);
  openPopup();
});

cancelEl.addEventListener('click', closePopup);

/* ====== ENVIAR ====== */
confirmEl.addEventListener('click', async ()=>{
  const nome = nomeEl.value.trim();
  const email = emailEl.value.trim();
  const tel = telEl.value.trim();
  const numeros = Array.from(selecionados).sort((a,b)=>a-b);

  if(!nome || !email || !tel || numeros.length===0){
    alert('Preencha os dados e selecione pelo menos um n√∫mero.');
    return;
  }

  showOverlay(true);
  try{
    const payload = {
      action: "registrar_rifa",
      nome, email, telefone: tel,
      numeros,
      quantidade: numeros.length,
      total: numeros.length * PRECO,
      pix: PIX_KEY
    };
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: {"Content-Type":"text/plain;charset=utf-8"},
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    showOverlay(false);

    if(/OK/i.test(text)){
      closePopup();
      openDrawer(numeros.length * PRECO);
      selecionados.clear();
      await loadVendidos();
      renderGrid(); updatePanel();
    }else if(/RESERVADO|DUPLICADO/i.test(text)){
      alert('‚ö†Ô∏è Alguns n√∫meros ficaram indispon√≠veis durante o processo. Atualizamos a lista.');
      await loadVendidos(); renderGrid(); updatePanel(); closePopup();
    }else{
      alert('‚ùå N√£o foi poss√≠vel enviar. Tente novamente.');
    }
  }catch(e){
    showOverlay(false);
    alert('Falha de conex√£o.');
  }
});

/* ====== PIX Drawer ====== */
copyPix.addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(PIX_KEY);
    copyPix.textContent = "Copiado!";
    setTimeout(()=>copyPix.textContent="Copiar chave PIX",1500);
  }catch{}
});
closeDrawer.addEventListener('click', closePixDrawer);

/* ====== BANNERS: autoplay + setas + bolinhas + selo ====== */
function renderDots(){
  dots.innerHTML = '';
  banners.forEach((_,i)=>{
    const s = document.createElement('span');
    if(i===bIndex) s.classList.add('on');
    s.addEventListener('click',()=>{bIndex=i;showBanner();resetAuto();});
    dots.appendChild(s);
  });
}
function showBanner(){
  const b = banners[bIndex];
  bannerImg.style.opacity = 0;
  setTimeout(()=>{
    bannerImg.src = b.img;
    bannerImg.alt = `${b.place} - ${b.name}`;
    prizePlace.textContent = b.place;
    prizeName.textContent  = b.name;
    prizeSub.textContent   = `Pr√™mio ${bIndex+1} de ${banners.length}`;
    bannerImg.onload = ()=>bannerImg.style.opacity = 1;
    renderDots();
  },100);
}
function nextBanner(){ bIndex=(bIndex+1)%banners.length; showBanner(); }
function prevBanner(){ bIndex=(bIndex-1+banners.length)%banners.length; showBanner(); }
function resetAuto(){ clearInterval(bTimer); bTimer = setInterval(nextBanner, 4500); }
function initBanners(){
  bIndex=0; showBanner(); resetAuto();
  next.addEventListener('click', ()=>{nextBanner(); resetAuto();});
  prev.addEventListener('click', ()=>{prevBanner(); resetAuto();});
}
</script>
</body>
</html>
